<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeonLobby</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º MQTT –∏ Google Fonts -->
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --glass-bg: rgba(20, 20, 30, 0.65);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-blur: 20px;
            --accent: #6366f1; /* Indigo */
            --accent-glow: rgba(99, 102, 241, 0.5);
            --text-primary: #f3f4f6;
            --text-secondary: #9ca3af;
            --success: #10b981;
            --danger: #ef4444;
            --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
        }

        * { box-sizing: border-box; outline: none; }
        
        body, html { 
            margin: 0; padding: 0; height: 100%; 
            font-family: 'Inter', sans-serif; 
            background: var(--bg-gradient);
            color: var(--text-primary);
            overflow: hidden;
        }

        /* --- Animations --- */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse-speak { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); } 70% { box-shadow: 0 0 0 6px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }

        .hidden { display: none !important; }

        /* --- Utility: Glass Effect --- */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
        }

        /* --- Login Screen --- */
        #login-screen {
            display: flex; height: 100vh; align-items: center; justify-content: center;
            background: radial-gradient(circle at 50% 50%, #2e2a5b 0%, #0f172a 100%);
        }
        .login-card {
            width: 360px; padding: 40px; border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            text-align: center;
            animation: fadeIn 0.6s ease-out;
        }
        .avatar-uploader {
            width: 100px; height: 100px; margin: 0 auto 20px;
            border-radius: 50%; border: 3px solid var(--glass-border);
            background-size: cover; background-position: center; background-color: #1f2937;
            cursor: pointer; transition: all 0.3s; position: relative;
        }
        .avatar-uploader:hover { border-color: var(--accent); transform: scale(1.05); }
        .avatar-uploader::after {
            content: '+'; position: absolute; bottom: 0; right: 0;
            background: var(--accent); color: white; width: 28px; height: 28px;
            border-radius: 50%; line-height: 28px; font-weight: bold;
        }
        
        input[type="text"] {
            width: 100%; padding: 14px; margin-bottom: 20px;
            background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border);
            border-radius: 12px; color: white; font-size: 1rem; text-align: center;
            transition: 0.3s;
        }
        input[type="text"]:focus { border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow); }
        
        .btn {
            width: 100%; padding: 14px; border: none; border-radius: 12px;
            font-weight: 600; font-size: 1rem; cursor: pointer; transition: 0.3s;
            background: var(--accent); color: white;
        }
        .btn:hover { background: #4f46e5; box-shadow: 0 0 20px var(--accent-glow); transform: translateY(-1px); }

        /* --- Main App Layout --- */
        #app-screen { display: flex; height: 100vh; opacity: 0; transition: opacity 0.5s; }
        #app-screen.visible { opacity: 1; }

        /* Sidebar */
        #sidebar {
            width: 280px; display: flex; flex-direction: column; z-index: 10;
            border-right: 1px solid var(--glass-border);
        }
        .app-header {
            padding: 20px; font-weight: 800; font-size: 1.2rem; letter-spacing: -0.5px;
            background: rgba(0,0,0,0.2); border-bottom: 1px solid var(--glass-border);
            display: flex; justify-content: space-between; align-items: center;
        }
        .logout-btn { background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 0.8rem; }
        .logout-btn:hover { color: var(--danger); }

        #user-list { flex: 1; overflow-y: auto; padding: 15px; }
        .user-item {
            display: flex; align-items: center; padding: 10px; 
            border-radius: 12px; margin-bottom: 5px; transition: 0.2s;
        }
        .user-item:hover { background: rgba(255,255,255,0.05); }
        .u-avatar {
            width: 42px; height: 42px; border-radius: 50%; margin-right: 12px;
            background-size: cover; background-color: #374151; border: 2px solid transparent;
            transition: all 0.2s;
        }
        /* –ê–Ω–∏–º–∞—Ü–∏—è –≥–æ–≤–æ—Ä–µ–Ω–∏—è */
        .is-speaking .u-avatar {
            border-color: var(--success);
            animation: pulse-speak 1.5s infinite;
        }
        
        .u-info { display: flex; flex-direction: column; }
        .u-name { font-weight: 600; font-size: 0.95rem; }
        .u-status { font-size: 0.75rem; color: var(--text-secondary); }

        /* Voice Panel */
        .voice-panel {
            padding: 20px; background: rgba(0,0,0,0.3);
            border-top: 1px solid var(--glass-border); display: flex; align-items: center; justify-content: space-between;
        }
        .mic-btn {
            width: 48px; height: 48px; border-radius: 50%; border: none;
            background: rgba(255,255,255,0.1); color: white; font-size: 1.2rem; cursor: pointer; transition: 0.3s;
            display: flex; align-items: center; justify-content: center;
        }
        .mic-btn:hover { background: rgba(255,255,255,0.2); }
        .mic-btn.active { background: var(--success); box-shadow: 0 0 15px rgba(16, 185, 129, 0.4); }
        .mic-btn.muted { background: var(--danger); position: relative; }
        .mic-btn.muted::after { content: ''; width: 2px; height: 24px; background: white; position: absolute; transform: rotate(45deg); }

        /* Chat Area */
        #chat-area { flex: 1; display: flex; flex-direction: column; position: relative; background: rgba(0,0,0,0.2); }
        #messages {
            flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 15px;
            scroll-behavior: smooth;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }

        .msg { display: flex; align-items: flex-start; animation: fadeIn 0.3s ease; max-width: 80%; }
        .msg.mine { align-self: flex-end; flex-direction: row-reverse; }
        
        .msg-ava { width: 36px; height: 36px; border-radius: 50%; background-size: cover; margin: 0 12px; flex-shrink: 0; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        
        .msg-bubble {
            background: rgba(255,255,255,0.05); padding: 12px 16px; border-radius: 18px;
            border-top-left-radius: 4px; color: var(--text-primary); line-height: 1.5;
            position: relative; border: 1px solid var(--glass-border);
        }
        .msg.mine .msg-bubble {
            background: var(--accent); border-top-left-radius: 18px; border-top-right-radius: 4px;
            box-shadow: 0 4px 15px var(--accent-glow); border: none;
        }
        .msg-meta { font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 4px; display: block; }
        .msg.mine .msg-meta { text-align: right; color: rgba(255,255,255,0.7); }

        /* Input Area */
        .chat-input-wrap { padding: 20px; }
        .chat-form {
            background: rgba(0,0,0,0.4); border-radius: 16px; padding: 8px 8px 8px 20px;
            display: flex; align-items: center; border: 1px solid var(--glass-border);
            transition: 0.3s;
        }
        .chat-form:focus-within { border-color: var(--accent); box-shadow: 0 0 20px rgba(99, 102, 241, 0.2); }
        .chat-input { background: transparent; border: none; color: white; width: 100%; font-size: 1rem; }
        .send-btn {
            background: rgba(255,255,255,0.1); border: none; border-radius: 10px;
            width: 40px; height: 40px; color: white; cursor: pointer; transition: 0.2s;
        }
        .send-btn:hover { background: var(--accent); }

        /* Diagnostics */
        #status-pill {
            position: absolute; top: 15px; right: 20px;
            background: rgba(0,0,0,0.6); padding: 6px 12px; border-radius: 20px;
            font-size: 0.75rem; color: var(--success); font-family: monospace;
            border: 1px solid var(--glass-border); pointer-events: none;
        }
    </style>
</head>
<body>

    <!-- LOGIN SCREEN -->
    <div id="login-screen">
        <div class="login-card glass">
            <h1 style="margin: 0 0 10px 0; font-weight: 800;">NEON<span style="color:var(--accent)">LOBBY</span></h1>
            <p style="color: var(--text-secondary); margin-bottom: 30px; font-size: 0.9rem;">Voice & Chat Space</p>
            
            <div id="avatar-preview" class="avatar-uploader" onclick="document.getElementById('avatar-upload').click()"></div>
            <input type="file" id="avatar-upload" accept="image/*" style="display:none">
            
            <input type="text" id="username-input" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –Ω–∏–∫–Ω–µ–π–º" maxlength="15">
            <button class="btn" onclick="app.manualJoin()">–í–æ–π—Ç–∏ –≤ –∫–æ–º–Ω–∞—Ç—É</button>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app-screen" class="glass hidden">
        <!-- Sidebar -->
        <div id="sidebar">
            <div class="app-header">
                <span>–£—á–∞—Å—Ç–Ω–∏–∫–∏</span>
                <button class="logout-btn" onclick="app.logout()">–í—ã–π—Ç–∏</button>
            </div>
            <div id="user-list">
                <!-- Users injected here -->
            </div>
            
            <div class="voice-panel">
                <div>
                    <div style="font-weight:600; font-size:0.9rem;">–ú–∏–∫—Ä–æ—Ñ–æ–Ω</div>
                    <div id="mic-status-text" style="font-size:0.75rem; color: var(--text-secondary);">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤–∫–ª.</div>
                </div>
                <button id="mic-btn" class="mic-btn muted" onclick="app.toggleMic()">üé§</button>
            </div>
        </div>

        <!-- Chat -->
        <div id="chat-area">
            <div id="status-pill">‚óè –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</div>
            <div id="messages"></div>
            
            <div class="chat-input-wrap">
                <div class="chat-form">
                    <input type="text" id="chat-input" class="chat-input" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
                    <button class="send-btn" onclick="app.sendMessage()">‚û§</button>
                </div>
            </div>
        </div>
    </div>

<script>
// --- CONFIG ---
const MQTT_BROKER = 'wss://broker.emqx.io:8084/mqtt';
const ROOM_ID = 'neon-lobby-v2'; // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∫–æ–º–Ω–∞—Ç—ã
const ICE_SERVERS = {
    iceServers: [
        { urls: 'stun:stun.l.google.com:19302' },
        { urls: 'stun:stun1.l.google.com:19302' }
        // –î–æ–±–∞–≤—å —Å—é–¥–∞ TURN –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    ]
};

class NetLobby {
    constructor() {
        this.client = null;
        this.localStream = null;
        this.peers = {}; 
        this.users = {}; 
        this.myId = 'u_' + Math.random().toString(36).substr(2, 9);
        this.myProfile = { name: '', avatar: '' };
        this.audioContext = null;
        this.isMuted = true;
        
        // MQTT Topics
        this.topicPresence = `${ROOM_ID}/presence`;
        this.topicSignal = `${ROOM_ID}/signal/${this.myId}`;
        this.topicChat = `${ROOM_ID}/chat`;
    }

    init() {
        // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é
        const sessionActive = localStorage.getItem('nl_session_active');
        const savedName = localStorage.getItem('nl_name');
        const savedAvatar = localStorage.getItem('nl_avatar');
        
        // –î–µ—Ñ–æ–ª—Ç–Ω–∞—è –∞–≤–∞—Ç–∞—Ä–∫–∞ (–≥—Ä–∞–¥–∏–µ–Ω—Ç)
        const defAvatar = 'https://ui-avatars.com/api/?background=6366f1&color=fff&name=User';

        if (savedAvatar) {
            this.myProfile.avatar = savedAvatar;
            document.getElementById('avatar-preview').style.backgroundImage = `url(${savedAvatar})`;
        } else {
            this.myProfile.avatar = defAvatar;
            document.getElementById('avatar-preview').style.backgroundImage = `url(${defAvatar})`;
        }

        if (savedName) document.getElementById('username-input').value = savedName;

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
        document.getElementById('avatar-upload').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                this.myProfile.avatar = ev.target.result;
                document.getElementById('avatar-preview').style.backgroundImage = `url(${this.myProfile.avatar})`;
            };
            reader.readAsDataURL(file);
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter –≤ —á–∞—Ç–µ
        document.getElementById('chat-input').addEventListener('keydown', (e) => {
            if(e.key === 'Enter') this.sendMessage();
        });

        // –ê–í–¢–û-–í–•–û–î
        if (sessionActive === 'true' && savedName) {
            console.log("Restoring session...");
            this.join(savedName, true); // true = skip UI animation logic immediately
        }
    }

    manualJoin() {
        const name = document.getElementById('username-input').value.trim();
        if (!name) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è");
        this.join(name, false);
    }

    async join(name, isAutoJoin) {
        this.myProfile.name = name;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ—Å—Å–∏—é
        localStorage.setItem('nl_name', name);
        localStorage.setItem('nl_avatar', this.myProfile.avatar);
        localStorage.setItem('nl_session_active', 'true');

        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —ç–∫—Ä–∞–Ω—ã
        document.getElementById('login-screen').classList.add('hidden');
        const appScreen = document.getElementById('app-screen');
        appScreen.classList.remove('hidden');
        
        // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ
        setTimeout(() => appScreen.classList.add('visible'), 50);

        // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω (–±—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç —Å–ø—Ä–æ—Å–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ)
        // –ü—Ä–∏ –∞–≤—Ç–æ-—Ä–µ—Ñ—Ä–µ—à–µ Chrome –æ–±—ã—á–Ω–æ –ø–æ–º–Ω–∏—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è HTTPS
        try {
            this.localStream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });
            // –°—Ä–∞–∑—É –º—å—é—Ç–∏–º –ø—Ä–∏ –≤—Ö–æ–¥–µ, —á—Ç–æ–±—ã –Ω–µ –ø—É–≥–∞—Ç—å
            this.localStream.getAudioTracks()[0].enabled = false; 
            this.setupVAD(this.localStream, this.myId);
        } catch (e) {
            console.warn("Mic error:", e);
        }

        this.connectMQTT();
    }

    logout() {
        localStorage.removeItem('nl_session_active');
        location.reload();
    }

    // --- MQTT Logic ---

    connectMQTT() {
        const statusEl = document.getElementById('status-pill');
        this.client = mqtt.connect(MQTT_BROKER);

        this.client.on('connect', () => {
            statusEl.textContent = '‚óè Online';
            statusEl.style.color = '#10b981'; // Green
            
            this.client.subscribe(this.topicPresence);
            this.client.subscribe(`${ROOM_ID}/signal/${this.myId}`);
            this.client.subscribe(this.topicChat);

            this.announce();
            setInterval(() => this.announce(), 4000);
        });

        this.client.on('message', (topic, msg) => {
            const data = JSON.parse(msg.toString());
            if (topic === this.topicPresence) this.handlePresence(data);
            else if (topic === this.topicChat) this.renderMessage(data);
            else this.handleSignal(data);
        });
    }

    announce() {
        this.client.publish(this.topicPresence, JSON.stringify({ 
            id: this.myId, user: this.myProfile 
        }));
    }

    handlePresence(data) {
        if (data.id === this.myId) return;
        
        if (!this.users[data.id]) {
            this.users[data.id] = data.user;
            this.updateRoster();
            // Mesh Logic: ID comparison to avoid double-call
            if (this.myId > data.id) this.createPeer(data.id, true);
        }
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É "–ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –≤–∏–¥–µ–ª–∏", —á—Ç–æ–±—ã —É–¥–∞–ª—è—Ç—å –æ—Ñ–ª–∞–π–Ω —é–∑–µ—Ä–æ–≤
    }

    // --- WebRTC Logic ---

    createPeer(targetId, initiator) {
        if (this.peers[targetId]) return;

        const pc = new RTCPeerConnection(ICE_SERVERS);
        if (this.localStream) {
            this.localStream.getTracks().forEach(t => pc.addTrack(t, this.localStream));
        }

        pc.onicecandidate = (e) => {
            if (e.candidate) this.sendSignal(targetId, { type: 'candidate', candidate: e.candidate });
        };

        pc.ontrack = (e) => {
            const audio = new Audio();
            audio.srcObject = e.streams[0];
            audio.autoplay = true;
            document.body.appendChild(audio);
            this.setupVAD(e.streams[0], targetId);
        };

        pc.oniceconnectionstatechange = () => {
            if(pc.iceConnectionState == 'disconnected') this.removePeer(targetId);
        };

        this.peers[targetId] = pc;

        if (initiator) {
            pc.createOffer().then(o => {
                pc.setLocalDescription(o);
                this.sendSignal(targetId, { type: 'sdp', sdp: o });
            });
        }
    }

    async handleSignal(data) {
        if (!this.peers[data.senderId]) this.createPeer(data.senderId, false);
        const pc = this.peers[data.senderId];
        const sig = data.payload;

        if (sig.type === 'sdp') {
            await pc.setRemoteDescription(new RTCSessionDescription(sig.sdp));
            if (sig.sdp.type === 'offer') {
                const ans = await pc.createAnswer();
                await pc.setLocalDescription(ans);
                this.sendSignal(data.senderId, { type: 'sdp', sdp: ans });
            }
        } else if (sig.type === 'candidate') {
            try { await pc.addIceCandidate(new RTCIceCandidate(sig.candidate)); } catch(e){}
        }
    }

    sendSignal(targetId, payload) {
        this.client.publish(`${ROOM_ID}/signal/${targetId}`, JSON.stringify({
            senderId: this.myId, payload
        }));
    }

    removePeer(id) {
        if(this.peers[id]) { this.peers[id].close(); delete this.peers[id]; }
        delete this.users[id];
        this.updateRoster();
    }

    // --- VAD (–ú–∏–≥–∞–Ω–∏–µ –∏–∫–æ–Ω–∫–∏) ---
    
    setupVAD(stream, userId) {
        if (!this.audioContext) this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
        if (this.audioContext.state === 'suspended') this.audioContext.resume();

        const src = this.audioContext.createMediaStreamSource(stream);
        const analyser = this.audioContext.createAnalyser();
        analyser.fftSize = 256;
        src.connect(analyser);
        
        const buffer = new Uint8Array(analyser.frequencyBinCount);

        const checkAudio = () => {
            // –ï—Å–ª–∏ —é–∑–µ—Ä –≤—ã—à–µ–ª, –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º (–¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –æ—Å—Ç–∞–≤–ª—è–µ–º —Ü–∏–∫–ª, –Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º DOM)
            analyser.getByteFrequencyData(buffer);
            let sum = 0;
            for(let val of buffer) sum += val;
            const volume = sum / buffer.length;

            // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç –≤ —Å–ø–∏—Å–∫–µ
            const el = document.querySelector(`.user-item[data-uid="${userId}"]`);
            if (el) {
                if (volume > 10) el.classList.add('is-speaking');
                else el.classList.remove('is-speaking');
            }
            requestAnimationFrame(checkAudio);
        };
        checkAudio();
    }

    // --- UI Helpers ---

    sendMessage() {
        const inp = document.getElementById('chat-input');
        const txt = inp.value.trim();
        if (!txt) return;
        
        this.client.publish(this.topicChat, JSON.stringify({
            id: this.myId,
            name: this.myProfile.name,
            avatar: this.myProfile.avatar,
            text: txt
        }));
        inp.value = '';
    }

    renderMessage(data) {
        const box = document.getElementById('messages');
        const isMe = data.id === this.myId;
        
        const div = document.createElement('div');
        div.className = `msg ${isMe ? 'mine' : ''}`;
        
        // Safe Text
        const safeText = data.text.replace(/</g, "&lt;");
        
        div.innerHTML = `
            <div class="msg-ava" style="background-image: url('${data.avatar}')"></div>
            <div class="msg-bubble">
                <span class="msg-meta">${isMe ? '–í—ã' : data.name}</span>
                ${safeText}
            </div>
        `;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }

    updateRoster() {
        const list = document.getElementById('user-list');
        list.innerHTML = '';

        // Render function
        const renderUser = (u, id, isMe) => {
            const div = document.createElement('div');
            div.className = 'user-item';
            div.setAttribute('data-uid', id); // Important for VAD
            div.innerHTML = `
                <div class="u-avatar" style="background-image: url('${u.avatar}')"></div>
                <div class="u-info">
                    <span class="u-name">${u.name} ${isMe ? '(–í—ã)' : ''}</span>
                    <span class="u-status">Online</span>
                </div>
            `;
            list.appendChild(div);
        };

        // Render Me first
        renderUser(this.myProfile, this.myId, true);
        // Render Others
        Object.keys(this.users).forEach(k => {
            renderUser(this.users[k], k, false);
        });
    }

    toggleMic() {
        if (!this.localStream) return;
        this.isMuted = !this.isMuted;
        this.localStream.getAudioTracks()[0].enabled = !this.isMuted;
        
        const btn = document.getElementById('mic-btn');
        const txt = document.getElementById('mic-status-text');
        
        if (this.isMuted) {
            btn.classList.remove('active');
            btn.classList.add('muted');
            txt.textContent = '–ú–∏–∫—Ä–æ—Ñ–æ–Ω –≤—ã–∫–ª—é—á–µ–Ω';
        } else {
            btn.classList.add('active');
            btn.classList.remove('muted');
            txt.textContent = '–ì–æ–≤–æ—Ä–∏—Ç–µ...';
        }
    }
}

// Start
const app = new NetLobby();
app.init();

</script>
</body>
</html>
